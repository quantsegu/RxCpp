<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>RxCpp: /home/travis/build/Reactive-Extensions/RxCpp/Rx/v2/src/rxcpp/rx-scheduler.hpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">RxCpp
   
   </div>
   <div id="projectbrief">The Reactive Extensions for Native (RxCpp) is a library for composing asynchronous and event-based programs using observable sequences and LINQ-style query operators in both C and C++.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/travis/build/Reactive-Extensions/RxCpp/Rx/v2/src/rxcpp/rx-scheduler.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rx-scheduler_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#pragma once</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span>
<a name="l00005"></a>00005 <span class="preprocessor">#if !defined(RXCPP_RX_SCHEDULER_HPP)</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">#define RXCPP_RX_SCHEDULER_HPP</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="rx-includes_8hpp.html">rx-includes.hpp</a>&quot;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">namespace </span>rxcpp {
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="namespacerxcpp_1_1schedulers.html">00012</a> <span class="keyword">namespace </span>schedulers {
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">worker_interface</a>;
<a name="l00015"></a>00015 <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">scheduler_interface</a>;
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html">00017</a> <span class="keyword">namespace </span>detail {
<a name="l00018"></a>00018 
<a name="l00019"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">00019</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">action_type</a>;
<a name="l00020"></a>00020 <span class="keyword">typedef</span> std::shared_ptr&lt;action_type&gt; <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">action_ptr</a>;
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a064775b2d0472e7ce80dc75fb90f07ff">00022</a> <span class="keyword">typedef</span> std::shared_ptr&lt;worker_interface&gt; <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a064775b2d0472e7ce80dc75fb90f07ff">worker_interface_ptr</a>;
<a name="l00023"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ad86032260209878268c4b75a9c4f50a9">00023</a> <span class="keyword">typedef</span> std::shared_ptr&lt;const worker_interface&gt; <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ad86032260209878268c4b75a9c4f50a9">const_worker_interface_ptr</a>;
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a3b44fe8d415bfb18e9577c523d1fc133">00025</a> <span class="keyword">typedef</span> std::shared_ptr&lt;scheduler_interface&gt; <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a3b44fe8d415bfb18e9577c523d1fc133">scheduler_interface_ptr</a>;
<a name="l00026"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ac6d36f7ec02d2240ae7cef3e2e928590">00026</a> <span class="keyword">typedef</span> std::shared_ptr&lt;const scheduler_interface&gt; <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ac6d36f7ec02d2240ae7cef3e2e928590">const_scheduler_interface_ptr</a>;
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1416b1cb59adb35a187e49537206e427">00028</a> <span class="keyword">inline</span> <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">action_ptr</a> <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1416b1cb59adb35a187e49537206e427">shared_empty</a>() {
<a name="l00029"></a>00029     <span class="keyword">static</span> <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">action_ptr</a> <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1416b1cb59adb35a187e49537206e427">shared_empty</a> = std::make_shared&lt;detail::action_type&gt;();
<a name="l00030"></a>00030     <span class="keywordflow">return</span> <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1416b1cb59adb35a187e49537206e427">shared_empty</a>;
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="comment">// It is essential to keep virtual function calls out of an inner loop.</span>
<a name="l00036"></a>00036 <span class="comment">// To make tail-recursion work efficiently the recursion objects create</span>
<a name="l00037"></a>00037 <span class="comment">// a space on the stack inside the virtual function call in the actor that</span>
<a name="l00038"></a>00038 <span class="comment">// allows the callback and the scheduler to share stack space that records</span>
<a name="l00039"></a>00039 <span class="comment">// the request and the allowance without any virtual calls in the loop.</span>
<a name="l00040"></a>00040 
<a name="l00043"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">00043</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a>
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045     <span class="keywordtype">bool</span>&amp; isrequested;
<a name="l00046"></a>00046     <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a> operator=(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a>&amp;);
<a name="l00047"></a>00047 <span class="keyword">public</span>:
<a name="l00048"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html#af6a8379cab04b0b166b37dfde85da981">00048</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html#af6a8379cab04b0b166b37dfde85da981">recursed</a>(<span class="keywordtype">bool</span>&amp; r)
<a name="l00049"></a>00049         : isrequested(r)
<a name="l00050"></a>00050     {
<a name="l00051"></a>00051     }
<a name="l00053"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html#a2df612759e02eb2e7cadf0e1bfe9de05">00053</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html#a2df612759e02eb2e7cadf0e1bfe9de05" title="request to be rescheduled">operator()</a>()<span class="keyword"> const </span>{
<a name="l00054"></a>00054         isrequested = <span class="keyword">true</span>;
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056 };
<a name="l00057"></a>00057 
<a name="l00060"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">00060</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062     <span class="keywordtype">bool</span>&amp; isallowed;
<a name="l00063"></a>00063     <span class="keyword">mutable</span> <span class="keywordtype">bool</span> isrequested;
<a name="l00064"></a>00064     <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a> requestor;
<a name="l00065"></a>00065     <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a> operator=(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp;);
<a name="l00066"></a>00066 <span class="keyword">public</span>:
<a name="l00067"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a71636e93f247461ab39aad99dc7a31fd">00067</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a71636e93f247461ab39aad99dc7a31fd">recurse</a>(<span class="keywordtype">bool</span>&amp; a)
<a name="l00068"></a>00068         : isallowed(a)
<a name="l00069"></a>00069         , isrequested(true)
<a name="l00070"></a>00070         , requestor(isrequested)
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072     }
<a name="l00074"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a8727f7e68d568cebefabd41eaf8b29d2">00074</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a8727f7e68d568cebefabd41eaf8b29d2" title="does the scheduler allow tail-recursion now?">is_allowed</a>()<span class="keyword"> const </span>{
<a name="l00075"></a>00075         <span class="keywordflow">return</span> isallowed;
<a name="l00076"></a>00076     }
<a name="l00078"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ad258c69e557c230d26619344f49cca38">00078</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ad258c69e557c230d26619344f49cca38" title="did the function request to be recursed?">is_requested</a>()<span class="keyword"> const </span>{
<a name="l00079"></a>00079         <span class="keywordflow">return</span> isrequested;
<a name="l00080"></a>00080     }
<a name="l00082"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ae698cfb8388cd3db6df9ddae343ece42">00082</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ae698cfb8388cd3db6df9ddae343ece42" title="reset the function request. call before each call to the function.">reset</a>()<span class="keyword"> const </span>{
<a name="l00083"></a>00083         isrequested = <span class="keyword">false</span>;
<a name="l00084"></a>00084     }
<a name="l00086"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a92dde52e195092f5ccaa59b540f52f71">00086</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a92dde52e195092f5ccaa59b540f52f71" title="get the recursed to set into the schedulable for the function to use to request recursion">get_recursed</a>()<span class="keyword"> const </span>{
<a name="l00087"></a>00087         <span class="keywordflow">return</span> requestor;
<a name="l00088"></a>00088     }
<a name="l00089"></a>00089 };
<a name="l00090"></a>00090 
<a name="l00092"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html">00092</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html" title="recursion is used by the scheduler to signal to each action whether tail recursion is allowed...">recursion</a>
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094     <span class="keyword">mutable</span> <span class="keywordtype">bool</span> isallowed;
<a name="l00095"></a>00095     <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a> recursor;
<a name="l00096"></a>00096     <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html" title="recursion is used by the scheduler to signal to each action whether tail recursion is allowed...">recursion</a> operator=(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html" title="recursion is used by the scheduler to signal to each action whether tail recursion is allowed...">recursion</a>&amp;);
<a name="l00097"></a>00097 <span class="keyword">public</span>:
<a name="l00098"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#ab447a9e0043f8fed2f8d2c0257db72b9">00098</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#ab447a9e0043f8fed2f8d2c0257db72b9">recursion</a>()
<a name="l00099"></a>00099         : isallowed(true)
<a name="l00100"></a>00100         , recursor(isallowed)
<a name="l00101"></a>00101     {
<a name="l00102"></a>00102     }
<a name="l00103"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#ac20793d70891076936d468d69f9c8053">00103</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#ab447a9e0043f8fed2f8d2c0257db72b9">recursion</a>(<span class="keywordtype">bool</span> b)
<a name="l00104"></a>00104         : isallowed(b)
<a name="l00105"></a>00105         , recursor(isallowed)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107     }
<a name="l00109"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#aeb54b73256103c474f81e3b9bc6dc8b4">00109</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#aeb54b73256103c474f81e3b9bc6dc8b4" title="set whether tail-recursion is allowed">reset</a>(<span class="keywordtype">bool</span> b = <span class="keyword">true</span>)<span class="keyword"> const </span>{
<a name="l00110"></a>00110         isallowed = b;
<a name="l00111"></a>00111     }
<a name="l00113"></a><a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#adb4ed28005993e7d600415e2962b0db1">00113</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1recursion.html#adb4ed28005993e7d600415e2962b0db1" title="get the recurse to pass into each action being called">get_recurse</a>()<span class="keyword"> const </span>{
<a name="l00114"></a>00114         <span class="keywordflow">return</span> recursor;
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 };
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html">00119</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html">action_base</a>
<a name="l00120"></a>00120 {
<a name="l00121"></a><a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html#a27d78509e60eeebb1e029867775028d7">00121</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1tag__action.html">tag_action</a> <a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html#a27d78509e60eeebb1e029867775028d7">action_tag</a>;
<a name="l00122"></a>00122 };
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>;
<a name="l00125"></a>00125 
<a name="l00127"></a><a class="code" href="classrxcpp_1_1schedulers_1_1action.html">00127</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> : <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html">action_base</a>
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">this_type</a>;
<a name="l00130"></a>00130     <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">detail::action_ptr</a> inner;
<a name="l00131"></a>00131 <span class="keyword">public</span>:
<a name="l00132"></a><a class="code" href="classrxcpp_1_1schedulers_1_1action.html#aaace086f3e60932d217742bbe5e225ca">00132</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#aaace086f3e60932d217742bbe5e225ca">action</a>()
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134     }
<a name="l00135"></a><a class="code" href="classrxcpp_1_1schedulers_1_1action.html#a4a6ea70f7363c1b5c526aff0a94ce930">00135</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#aaace086f3e60932d217742bbe5e225ca">action</a>(<a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1ec8eb4e8adaec0ef8742b73b8deba53">detail::action_ptr</a> i)
<a name="l00136"></a>00136     : inner(std::move(i))
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139 
<a name="l00141"></a><a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ab5de5c2c2c2072d8ab8569bb51de6771">00141</a>     <span class="keyword">inline</span> <span class="keyword">static</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ab5de5c2c2c2072d8ab8569bb51de6771" title="return the empty action">empty</a>() {
<a name="l00142"></a>00142         <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#aaace086f3e60932d217742bbe5e225ca">action</a>(<a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a1416b1cb59adb35a187e49537206e427">detail::shared_empty</a>());
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00146"></a>00146     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ae7fda8d51056eb1916fc9bb366a62f61" title="call the function">operator()</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; s, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r) <span class="keyword">const</span>;
<a name="l00147"></a>00147 };
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html">00149</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html">scheduler_base</a>
<a name="l00150"></a>00150 {
<a name="l00151"></a><a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">00151</a>     <span class="keyword">typedef</span> std::chrono::steady_clock <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">clock_type</a>;
<a name="l00152"></a><a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#a24c5fa7a3583973e49c70c4706896e74">00152</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1tag__scheduler.html">tag_scheduler</a> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#a24c5fa7a3583973e49c70c4706896e74">scheduler_tag</a>;
<a name="l00153"></a>00153 };
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html">00155</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html">worker_base</a> : <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1subscription__base.html">subscription_base</a>
<a name="l00156"></a>00156 {
<a name="l00157"></a><a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html#ab9410cacfcd55b9b33b6396cd9569ae4">00157</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1tag__worker.html">tag_worker</a> <a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html#ab9410cacfcd55b9b33b6396cd9569ae4">worker_tag</a>;
<a name="l00158"></a>00158 };
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">00160</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">worker_interface</a>
<a name="l00161"></a>00161     : <span class="keyword">public</span> std::<a class="code" href="classstd_1_1enable__shared__from__this.html">enable_shared_from_this</a>&lt;worker_interface&gt;
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">worker_interface</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">this_type</a>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="keyword">public</span>:
<a name="l00166"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#a7525df8271badd93261d1b64f9fe1546">00166</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">scheduler_base::clock_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#a7525df8271badd93261d1b64f9fe1546">clock_type</a>;
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#a0734c67fbaaa45099ba5da7555d50d20">00168</a>     <span class="keyword">virtual</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#a0734c67fbaaa45099ba5da7555d50d20">~worker_interface</a>() {}
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keyword">virtual</span> clock_type::time_point <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#a2c8f78f6c8b07e7d756856b8faeb1db4">now</a>() <span class="keyword">const</span> = 0;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#ab8d6acc35ac8696c55e8e53e2f89aaf6">schedule</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl) <span class="keyword">const</span> = 0;
<a name="l00173"></a>00173     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html#ab8d6acc35ac8696c55e8e53e2f89aaf6">schedule</a>(clock_type::time_point when, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl) <span class="keyword">const</span> = 0;
<a name="l00174"></a>00174 };
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="keyword">namespace </span>detail {
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00179"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html">00179</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html">is_action_function</a>
<a name="l00180"></a>00180 {
<a name="l00181"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function_1_1not__void.html">00181</a>     <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function_1_1not__void.html">not_void</a> {};
<a name="l00182"></a>00182     <span class="keyword">template</span>&lt;<span class="keyword">class</span> CF&gt;
<a name="l00183"></a>00183     <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html#a6902d58c8d4d58123b2256b7be0815b7">check</a>(<span class="keywordtype">int</span>) -&gt; decltype((*(CF*)<span class="keyword">nullptr</span>)(*(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>*)<span class="keyword">nullptr</span>));
<a name="l00184"></a>00184     <span class="keyword">template</span>&lt;<span class="keyword">class</span> CF&gt;
<a name="l00185"></a>00185     <span class="keyword">static</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function_1_1not__void.html">not_void</a> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html#a6902d58c8d4d58123b2256b7be0815b7">check</a>(...);
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html#a95f8104ca59664e630d9d6bb0cb639f6">00187</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html#a95f8104ca59664e630d9d6bb0cb639f6">value</a> = std::is_same&lt;decltype(check&lt;rxu::decay_t&lt;F&gt;&gt;(0)), <span class="keywordtype">void</span>&gt;<a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html#a95f8104ca59664e630d9d6bb0cb639f6">::value</a>;
<a name="l00188"></a>00188 };
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00195"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">00195</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> : <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html">worker_base</a>
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">this_type</a>;
<a name="l00198"></a>00198     <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a064775b2d0472e7ce80dc75fb90f07ff">detail::worker_interface_ptr</a> inner;
<a name="l00199"></a>00199     <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> lifetime;
<a name="l00200"></a>00200     <span class="keyword">friend</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a58f8d29af6202060e4bf8f8dd75d4df7">operator==</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp;, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp;);
<a name="l00201"></a>00201 <span class="keyword">public</span>:
<a name="l00202"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">00202</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">scheduler_base::clock_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>;
<a name="l00203"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a4fa6d15010b671314dc51838c01de0da">00203</a>     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1composite__subscription.html#af1555850425b699ed9dc47550c7a3695">composite_subscription::weak_subscription</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a4fa6d15010b671314dc51838c01de0da">weak_subscription</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff163fac4dbc7b3918f85a541c172222">00205</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff163fac4dbc7b3918f85a541c172222">worker</a>()
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207     }
<a name="l00208"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1297bcd7058a2bc02d3c949f79508c39">00208</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff163fac4dbc7b3918f85a541c172222">worker</a>(<a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ad86032260209878268c4b75a9c4f50a9">detail::const_worker_interface_ptr</a> i)
<a name="l00209"></a>00209         : inner(std::const_pointer_cast&lt;<a class="code" href="classrxcpp_1_1schedulers_1_1worker__interface.html">worker_interface</a>&gt;(i))
<a name="l00210"></a>00210         , lifetime(std::move(cs))
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212     }
<a name="l00213"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a897d0626f55ecf86309ae62443d322c1">00213</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff163fac4dbc7b3918f85a541c172222">worker</a>(<a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> o)
<a name="l00214"></a>00214         : inner(o.inner)
<a name="l00215"></a>00215         , lifetime(std::move(cs))
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff08bcb8c7202e066ee4c76b84ef0400">00219</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff08bcb8c7202e066ee4c76b84ef0400">get_subscription</a>()<span class="keyword"> const </span>{
<a name="l00220"></a>00220         <span class="keywordflow">return</span> lifetime;
<a name="l00221"></a>00221     }
<a name="l00222"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ad30a95763a1365eb2f1d6d16be3ebeb1">00222</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ad30a95763a1365eb2f1d6d16be3ebeb1">get_subscription</a>() {
<a name="l00223"></a>00223         <span class="keywordflow">return</span> lifetime;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">// composite_subscription</span>
<a name="l00227"></a>00227     <span class="comment">//</span>
<a name="l00228"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">00228</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">is_subscribed</a>()<span class="keyword"> const </span>{
<a name="l00229"></a>00229         <span class="keywordflow">return</span> lifetime.<a class="code" href="classrxcpp_1_1subscription.html#ae8756b423a7c503b2528d2ef7f7bcc0f">is_subscribed</a>();
<a name="l00230"></a>00230     }
<a name="l00231"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab5e1c566f5974a74abb5fefb05c043a7">00231</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a4fa6d15010b671314dc51838c01de0da">weak_subscription</a> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab5e1c566f5974a74abb5fefb05c043a7">add</a>(<a class="code" href="classrxcpp_1_1subscription.html">subscription</a> s)<span class="keyword"> const </span>{
<a name="l00232"></a>00232         <span class="keywordflow">return</span> lifetime.<a class="code" href="classrxcpp_1_1composite__subscription.html#ad0debf6314a751c428790dcbf0ff5ef3">add</a>(std::move(s));
<a name="l00233"></a>00233     }
<a name="l00234"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a0e17d49d3379e50407d0dfbdf07ae887">00234</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">remove</span>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a4fa6d15010b671314dc51838c01de0da">weak_subscription</a> w) <span class="keyword">const</span> {
<a name="l00235"></a>00235         <span class="keywordflow">return</span> lifetime.<a class="code" href="classrxcpp_1_1composite__subscription.html#a954536a0aaef698f7a5964f008478ae9">remove</a>(std::move(w));
<a name="l00236"></a>00236     }
<a name="l00237"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#abd6c5805c39a77ae252f8c8a452066e7">00237</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#abd6c5805c39a77ae252f8c8a452066e7">clear</a>()<span class="keyword"> const </span>{
<a name="l00238"></a>00238         <span class="keywordflow">return</span> lifetime.<a class="code" href="classrxcpp_1_1detail_1_1composite__subscription__inner.html#a9139075b5efa10ffa90be5e4a82accd3">clear</a>();
<a name="l00239"></a>00239     }
<a name="l00240"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ae617a03ccea121d87d5d056bfb60e48e">00240</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ae617a03ccea121d87d5d056bfb60e48e">unsubscribe</a>()<span class="keyword"> const </span>{
<a name="l00241"></a>00241         <span class="keywordflow">return</span> lifetime.<a class="code" href="classrxcpp_1_1detail_1_1composite__subscription__inner.html#af54f4ee580c9bde811db1ab1aefa7158">unsubscribe</a>();
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="comment">// worker_interface</span>
<a name="l00245"></a>00245     <span class="comment">//</span>
<a name="l00247"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab632486c80c50f8c1803ab106b7a1283">00247</a> <span class="comment"></span>    <span class="keyword">inline</span> clock_type::time_point <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab632486c80c50f8c1803ab106b7a1283" title="return the current time for this worker">now</a>()<span class="keyword"> const </span>{
<a name="l00248"></a>00248         <span class="keywordflow">return</span> inner-&gt;now();
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 
<a name="l00252"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd">00252</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd" title="insert the supplied schedulable to be run as soon as possible">schedule</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)<span class="keyword"> const </span>{
<a name="l00253"></a>00253         <span class="comment">// force rebinding scbl to this worker</span>
<a name="l00254"></a>00254         <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">schedule_rebind</a>(scbl);
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00258"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ac5e3f27fb042c13f47a9afe79bb32e5e">00258</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ac5e3f27fb042c13f47a9afe79bb32e5e" title="insert the supplied schedulable to be run at the time specified">schedule</a>(clock_type::time_point when, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)<span class="keyword"> const </span>{
<a name="l00259"></a>00259         <span class="comment">// force rebinding scbl to this worker</span>
<a name="l00260"></a>00260         <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">schedule_rebind</a>(when, scbl);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">// helpers</span>
<a name="l00264"></a>00264     <span class="comment">//</span>
<a name="l00265"></a>00265 
<a name="l00267"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aaa53ea710bcd8eff96b7e0e9702556a9">00267</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aaa53ea710bcd8eff96b7e0e9702556a9" title="insert the supplied schedulable to be run at now() + the delay specified">schedule</a>(clock_type::duration when, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)<span class="keyword"> const </span>{
<a name="l00268"></a>00268         <span class="comment">// force rebinding scbl to this worker</span>
<a name="l00269"></a>00269         <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">schedule_rebind</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab632486c80c50f8c1803ab106b7a1283" title="return the current time for this worker">now</a>() + when, scbl);
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 
<a name="l00274"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab62a74b37fd25d73239204e93d1cece9">00274</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab62a74b37fd25d73239204e93d1cece9">schedule_periodically</a>(clock_type::time_point initial, clock_type::duration period, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)<span class="keyword"> const </span>{
<a name="l00275"></a>00275         <span class="comment">// force rebinding scbl to this worker</span>
<a name="l00276"></a>00276         <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">schedule_periodically_rebind</a>(initial, period, scbl);
<a name="l00277"></a>00277     }
<a name="l00278"></a>00278 
<a name="l00281"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8584a6501c0e44d1a05986741e725081">00281</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8584a6501c0e44d1a05986741e725081">schedule_periodically</a>(clock_type::duration initial, clock_type::duration period, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)<span class="keyword"> const </span>{
<a name="l00282"></a>00282         <span class="comment">// force rebinding scbl to this worker</span>
<a name="l00283"></a>00283         <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">schedule_periodically_rebind</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab632486c80c50f8c1803ab106b7a1283" title="return the current time for this worker">now</a>() + initial, period, scbl);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 
<a name="l00287"></a>00287     <span class="keyword">template</span>&lt;<span class="keyword">class </span>Arg0, <span class="keyword">class</span>... ArgN&gt;
<a name="l00288"></a>00288     <span class="keyword">auto</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd" title="insert the supplied schedulable to be run as soon as possible">schedule</a>(Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00289"></a>00289         -&gt; typename std::enable_if&lt;
<a name="l00290"></a>00290             (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00291"></a>00291             <a class="code" href="classrxcpp_1_1is__subscription.html">is_subscription</a>&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00292"></a>00292             !<a class="code" href="classrxcpp_1_1is__schedulable.html">is_schedulable</a>&lt;Arg0&gt;::value&gt;::type;
<a name="l00293"></a>00293     template&lt;class... ArgN&gt;
<a name="l00295"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">00295</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">schedule_rebind</a>(const <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl, ArgN&amp;&amp;... an) const;
<a name="l00296"></a>00296 
<a name="l00298"></a>00298     template&lt;class Arg0, class... ArgN&gt;
<a name="l00299"></a>00299     auto <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd" title="insert the supplied schedulable to be run as soon as possible">schedule</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::time_point when, Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00300"></a>00300         -&gt; typename std::enable_if&lt;
<a name="l00301"></a>00301             (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00302"></a>00302             <a class="code" href="classrxcpp_1_1is__subscription.html">is_subscription</a>&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00303"></a>00303             !<a class="code" href="classrxcpp_1_1is__schedulable.html">is_schedulable</a>&lt;Arg0&gt;::value&gt;::type;
<a name="l00305"></a>00305     template&lt;class... ArgN&gt;
<a name="l00306"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a37832604bdf8e2f910421d1be6d703b1">00306</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">schedule_rebind</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::time_point when, const <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl, ArgN&amp;&amp;... an) const;
<a name="l00307"></a>00307 
<a name="l00309"></a>00309     template&lt;class Arg0, class... ArgN&gt;
<a name="l00310"></a>00310     auto <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab62a74b37fd25d73239204e93d1cece9">schedule_periodically</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::time_point initial, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::duration period, Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00311"></a>00311         -&gt; typename std::enable_if&lt;
<a name="l00312"></a>00312             (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00313"></a>00313             <a class="code" href="classrxcpp_1_1is__subscription.html">is_subscription</a>&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00314"></a>00314             !<a class="code" href="classrxcpp_1_1is__schedulable.html">is_schedulable</a>&lt;Arg0&gt;::value&gt;::type;
<a name="l00316"></a>00316     template&lt;class... ArgN&gt;
<a name="l00317"></a><a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">00317</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">schedule_periodically_rebind</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::time_point initial, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a6f1cbb11b6dc83a864e5996f186f3272">clock_type</a>::duration period, const <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl, ArgN&amp;&amp;... an) const;
<a name="l00318"></a>00318 };
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#aaa8c93d779500ec62cf5353b3e9330c0">00320</a> inline <span class="keywordtype">bool</span> operator==(const <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; lhs, const <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; rhs) {
<a name="l00321"></a>00321     <span class="keywordflow">return</span> lhs.inner == rhs.inner &amp;&amp; lhs.lifetime == rhs.lifetime;
<a name="l00322"></a>00322 }
<a name="l00323"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a62746cb386e47eae1e701f5fbb6f0263">00323</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a62746cb386e47eae1e701f5fbb6f0263">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; rhs) {
<a name="l00324"></a>00324     <span class="keywordflow">return</span> !(lhs == rhs);
<a name="l00325"></a>00325 }
<a name="l00326"></a>00326 
<a name="l00327"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">00327</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">scheduler_interface</a>
<a name="l00328"></a>00328     : <span class="keyword">public</span> std::<a class="code" href="classstd_1_1enable__shared__from__this.html">enable_shared_from_this</a>&lt;scheduler_interface&gt;
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">scheduler_interface</a> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">this_type</a>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="keyword">public</span>:
<a name="l00333"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html#a0b63971112a6b566e20bc8406b6b1738">00333</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">scheduler_base::clock_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html#a0b63971112a6b566e20bc8406b6b1738">clock_type</a>;
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html#ad2f47801a2d33c0bbf1ff5677e28c7e3">00335</a>     <span class="keyword">virtual</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html#ad2f47801a2d33c0bbf1ff5677e28c7e3">~scheduler_interface</a>() {}
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="keyword">virtual</span> clock_type::time_point <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab632486c80c50f8c1803ab106b7a1283" title="return the current time for this worker">now</a>() <span class="keyword">const</span> = 0;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <span class="keyword">virtual</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> create_worker(<a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs) <span class="keyword">const</span> = 0;
<a name="l00340"></a>00340 };
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a><a class="code" href="structrxcpp_1_1schedulers_1_1schedulable__base.html">00343</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1schedulable__base.html">schedulable_base</a> :
<a name="l00344"></a>00344     <span class="comment">// public subscription_base, &lt;- already in worker base</span>
<a name="l00345"></a>00345     <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1worker__base.html">worker_base</a>,
<a name="l00346"></a>00346     <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1action__base.html">action_base</a>
<a name="l00347"></a>00347 {
<a name="l00348"></a><a class="code" href="structrxcpp_1_1schedulers_1_1schedulable__base.html#a5267728efd2fd188c539c2770542de1a">00348</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1tag__schedulable.html">tag_schedulable</a> <a class="code" href="structrxcpp_1_1schedulers_1_1schedulable__base.html#a5267728efd2fd188c539c2770542de1a">schedulable_tag</a>;
<a name="l00349"></a>00349 };
<a name="l00350"></a>00350 
<a name="l00357"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html">00357</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a> : <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html">scheduler_base</a>
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">this_type</a>;
<a name="l00360"></a>00360     <a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a3b44fe8d415bfb18e9577c523d1fc133">detail::scheduler_interface_ptr</a> inner;
<a name="l00361"></a>00361     <span class="keyword">friend</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a58f8d29af6202060e4bf8f8dd75d4df7">operator==</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>&amp;, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>&amp;);
<a name="l00362"></a>00362 <span class="keyword">public</span>:
<a name="l00363"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a1ce7596f2da297b7980464ecdf7fd522">00363</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">scheduler_base::clock_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a1ce7596f2da297b7980464ecdf7fd522">clock_type</a>;
<a name="l00364"></a>00364 
<a name="l00365"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#ac90589b4cd7f09638a83b78b5936313b">00365</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>()
<a name="l00366"></a>00366     {
<a name="l00367"></a>00367     }
<a name="l00368"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a394045e783eb2913c31d3c03240ecfaa">00368</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>(<a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#a3b44fe8d415bfb18e9577c523d1fc133">detail::scheduler_interface_ptr</a> i)
<a name="l00369"></a>00369         : inner(std::move(i))
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371     }
<a name="l00372"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a4164d302b9213fdeb5d47fbb1da43fac">00372</a>     <span class="keyword">explicit</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>(<a class="code" href="namespacerxcpp_1_1schedulers_1_1detail.html#ac6d36f7ec02d2240ae7cef3e2e928590">detail::const_scheduler_interface_ptr</a> i)
<a name="l00373"></a>00373     : inner(std::move(std::const_pointer_cast&lt;<a class="code" href="classrxcpp_1_1schedulers_1_1scheduler__interface.html">scheduler_interface</a>&gt;(i)))
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376 
<a name="l00378"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a2678fc662ffc2f530e6bab74219938ad">00378</a>     <span class="keyword">inline</span> clock_type::time_point <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#a2678fc662ffc2f530e6bab74219938ad" title="return the current time for this scheduler">now</a>()<span class="keyword"> const </span>{
<a name="l00379"></a>00379         <span class="keywordflow">return</span> inner-&gt;now();
<a name="l00380"></a>00380     }
<a name="l00386"></a><a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#afaa59eb181a81beb60cd0352704d288d">00386</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html#afaa59eb181a81beb60cd0352704d288d">create_worker</a>(<a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs = <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a>())<span class="keyword"> const </span>{
<a name="l00387"></a>00387         <span class="keywordflow">return</span> inner-&gt;create_worker(cs);
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 };
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="keyword">template</span>&lt;<span class="keyword">class </span>Scheduler, <span class="keyword">class</span>... ArgN&gt;
<a name="l00392"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a6aee01229adf0485720e8fd5c4d8a34e">00392</a> <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a> <a class="code" href="namespacerxcpp_1_1schedulers.html#a6aee01229adf0485720e8fd5c4d8a34e">make_scheduler</a>(ArgN&amp;&amp;... an) {
<a name="l00393"></a>00393     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1scheduler.html" title="allows functions to be called at specified times and possibly in other contexts.">scheduler</a>(std::static_pointer_cast&lt;scheduler_interface&gt;(std::make_shared&lt;Scheduler&gt;(std::forward&lt;ArgN&gt;(an)...)));
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">00397</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> : <span class="keyword">public</span> <a class="code" href="structrxcpp_1_1schedulers_1_1schedulable__base.html">schedulable_base</a>
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">this_type</a>;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> lifetime;
<a name="l00402"></a>00402     <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> controller;
<a name="l00403"></a>00403     <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> activity;
<a name="l00404"></a>00404     <span class="keywordtype">bool</span> scoped;
<a name="l00405"></a>00405     <a class="code" href="classrxcpp_1_1composite__subscription.html#af1555850425b699ed9dc47550c7a3695">composite_subscription::weak_subscription</a> action_scope;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     <span class="keyword">struct </span>detacher
<a name="l00408"></a>00408     {
<a name="l00409"></a>00409         ~detacher()
<a name="l00410"></a>00410         {
<a name="l00411"></a>00411             <span class="keywordflow">if</span> (that) {
<a name="l00412"></a>00412                 that-&gt;unsubscribe();
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415         detacher(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">this_type</a>* that)
<a name="l00416"></a>00416             : that(that)
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418         }
<a name="l00419"></a>00419         <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">this_type</a>* that;
<a name="l00420"></a>00420     };
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keyword">class </span>recursed_scope_type
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424         <span class="keyword">mutable</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recursed.html">recursed</a>* requestor;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="keyword">class </span>exit_recursed_scope_type
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428             <span class="keyword">const</span> recursed_scope_type* that;
<a name="l00429"></a>00429         <span class="keyword">public</span>:
<a name="l00430"></a>00430             ~exit_recursed_scope_type()
<a name="l00431"></a>00431             {
<a name="l00432"></a>00432                     that-&gt;requestor = <span class="keyword">nullptr</span>;
<a name="l00433"></a>00433             }
<a name="l00434"></a>00434             exit_recursed_scope_type(<span class="keyword">const</span> recursed_scope_type* that)
<a name="l00435"></a>00435                 : that(that)
<a name="l00436"></a>00436             {
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438         };
<a name="l00439"></a>00439     <span class="keyword">public</span>:
<a name="l00440"></a>00440         recursed_scope_type()
<a name="l00441"></a>00441             : requestor(<span class="keyword">nullptr</span>)
<a name="l00442"></a>00442         {
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444         recursed_scope_type(<span class="keyword">const</span> recursed_scope_type&amp;)
<a name="l00445"></a>00445             : requestor(<span class="keyword">nullptr</span>)
<a name="l00446"></a>00446         {
<a name="l00447"></a>00447             <span class="comment">// does not aquire recursion scope</span>
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449         recursed_scope_type&amp; operator=(<span class="keyword">const</span> recursed_scope_type&amp; )
<a name="l00450"></a>00450         {
<a name="l00451"></a>00451             <span class="comment">// no change in recursion scope</span>
<a name="l00452"></a>00452             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454         exit_recursed_scope_type reset(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r)<span class="keyword"> const </span>{
<a name="l00455"></a>00455             requestor = std::addressof(r.<a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a92dde52e195092f5ccaa59b540f52f71" title="get the recursed to set into the schedulable for the function to use to request recursion">get_recursed</a>());
<a name="l00456"></a>00456             <span class="keywordflow">return</span> exit_recursed_scope_type(<span class="keyword">this</span>);
<a name="l00457"></a>00457         }
<a name="l00458"></a>00458         <span class="keywordtype">bool</span> is_recursed()<span class="keyword"> const </span>{
<a name="l00459"></a>00459             <span class="keywordflow">return</span> !!requestor;
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461         <span class="keywordtype">void</span> operator()()<span class="keyword"> const </span>{
<a name="l00462"></a>00462             (*requestor)();
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464     };
<a name="l00465"></a>00465     recursed_scope_type recursed_scope;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="keyword">public</span>:
<a name="l00468"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">00468</a>     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1composite__subscription.html#af1555850425b699ed9dc47550c7a3695">composite_subscription::weak_subscription</a> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">weak_subscription</a>;
<a name="l00469"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3887af56bedaa4200bde6f1a2be26679">00469</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1scheduler__base.html#af55b0be95e0c842a5d235385fba23ea9">scheduler_base::clock_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3887af56bedaa4200bde6f1a2be26679">clock_type</a>;
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#acd6d60a295ffcec0e195c30c4adb9403">00471</a>     ~<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>()
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473         <span class="keywordflow">if</span> (scoped) {
<a name="l00474"></a>00474             controller.<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a428807ac9037d03a754bfac19d97f60e">remove</a>(action_scope);
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476     }
<a name="l00477"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a268358328b6efb216376d3b016c9aed9">00477</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>()
<a name="l00478"></a>00478         : scoped(false)
<a name="l00479"></a>00479     {
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00483"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ac1bce4ef5ee3040ab4bb6e7da1fa048e">00483</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> q, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> a)
<a name="l00484"></a>00484         : lifetime(q.<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff08bcb8c7202e066ee4c76b84ef0400">get_subscription</a>())
<a name="l00485"></a>00485         , controller(std::move(q))
<a name="l00486"></a>00486         , activity(std::move(a))
<a name="l00487"></a>00487         , scoped(false)
<a name="l00488"></a>00488     {
<a name="l00489"></a>00489     }
<a name="l00491"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae8540e968350e8c96cae32dd84edfedf">00491</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(<a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> q, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> a)
<a name="l00492"></a>00492         : lifetime(std::move(cs))
<a name="l00493"></a>00493         , controller(std::move(q))
<a name="l00494"></a>00494         , activity(std::move(a))
<a name="l00495"></a>00495         , scoped(true)
<a name="l00496"></a>00496         , action_scope(controller.<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab5e1c566f5974a74abb5fefb05c043a7">add</a>(lifetime))
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498     }
<a name="l00500"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae26628d02bd8294b07300dd63e4c131b">00500</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> q, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> a)
<a name="l00501"></a>00501         : lifetime(scbl.<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#aff08bcb8c7202e066ee4c76b84ef0400">get_subscription</a>())
<a name="l00502"></a>00502         , controller(std::move(q))
<a name="l00503"></a>00503         , activity(std::move(a))
<a name="l00504"></a>00504         , scoped(scbl.scoped)
<a name="l00505"></a>00505         , action_scope(scbl.scoped ? controller.<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab5e1c566f5974a74abb5fefb05c043a7">add</a>(lifetime) : <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">weak_subscription</a>())
<a name="l00506"></a>00506     {
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00509"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3f3cf868fe0ff3a9da07d9b13834bae3">00509</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3f3cf868fe0ff3a9da07d9b13834bae3">get_subscription</a>()<span class="keyword"> const </span>{
<a name="l00510"></a>00510         <span class="keywordflow">return</span> lifetime;
<a name="l00511"></a>00511     }
<a name="l00512"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a2652c6cbcdc47a6d811e0b5be0e53f73">00512</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a2652c6cbcdc47a6d811e0b5be0e53f73">get_subscription</a>() {
<a name="l00513"></a>00513         <span class="keywordflow">return</span> lifetime;
<a name="l00514"></a>00514     }
<a name="l00515"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ac41ea37aa23924ce93c6353d6b835e26">00515</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ac41ea37aa23924ce93c6353d6b835e26">get_worker</a>()<span class="keyword"> const </span>{
<a name="l00516"></a>00516         <span class="keywordflow">return</span> controller;
<a name="l00517"></a>00517     }
<a name="l00518"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a736675375f75d225feacebcf4d17bfc0">00518</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a736675375f75d225feacebcf4d17bfc0">get_worker</a>() {
<a name="l00519"></a>00519         <span class="keywordflow">return</span> controller;
<a name="l00520"></a>00520     }
<a name="l00521"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#aca9585ac186dd7a99e35c68b02722c0d">00521</a>     <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#aca9585ac186dd7a99e35c68b02722c0d">get_action</a>()<span class="keyword"> const </span>{
<a name="l00522"></a>00522         <span class="keywordflow">return</span> activity;
<a name="l00523"></a>00523     }
<a name="l00524"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a213685cfee4d30e9cc957afba9d0cce4">00524</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a213685cfee4d30e9cc957afba9d0cce4">get_action</a>() {
<a name="l00525"></a>00525         <span class="keywordflow">return</span> activity;
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#aba6f189179f0b5eff094066ba552739e">00528</a>     <span class="keyword">inline</span> <span class="keyword">static</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#aba6f189179f0b5eff094066ba552739e">empty</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc) {
<a name="l00529"></a>00529         <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(<a class="code" href="classrxcpp_1_1composite__subscription.html#a9f297b3f30a0cfeb2f1faf25416c3d38">composite_subscription::empty</a>(), sc, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ab5de5c2c2c2072d8ab8569bb51de6771" title="return the empty action">action::empty</a>());
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00532"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#af90a8fc1c5c9ec22cb5db31aa3ea38d4">00532</a>     <span class="keyword">inline</span> <span class="keyword">auto</span> set_recursed(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r) <span class="keyword">const</span>
<a name="l00533"></a>00533         -&gt; decltype(recursed_scope.reset(r)) {
<a name="l00534"></a>00534         <span class="keywordflow">return</span>      recursed_scope.reset(r);
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">// recursed</span>
<a name="l00538"></a>00538     <span class="comment">//</span>
<a name="l00539"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a9696ebc4a66bd504960e465878b684d0">00539</a>     <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a9696ebc4a66bd504960e465878b684d0">is_recursed</a>()<span class="keyword"> const </span>{
<a name="l00540"></a>00540         <span class="keywordflow">return</span> recursed_scope.is_recursed();
<a name="l00541"></a>00541     }
<a name="l00550"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a6a50ff22054477f509f24824bcee2eae">00550</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a6a50ff22054477f509f24824bcee2eae">operator()</a>()<span class="keyword"> const </span>{
<a name="l00551"></a>00551         recursed_scope();
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <span class="comment">// composite_subscription</span>
<a name="l00555"></a>00555     <span class="comment">//</span>
<a name="l00556"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a5f205d35d687432625d8a44994a59c53">00556</a>     <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a5f205d35d687432625d8a44994a59c53">is_subscribed</a>()<span class="keyword"> const </span>{
<a name="l00557"></a>00557         <span class="keywordflow">return</span> lifetime.is_subscribed();
<a name="l00558"></a>00558     }
<a name="l00559"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a7d32d86c8734ab9c2a8bee24e58e469d">00559</a>     <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">weak_subscription</a> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a7d32d86c8734ab9c2a8bee24e58e469d">add</a>(<a class="code" href="classrxcpp_1_1subscription.html">subscription</a> s)<span class="keyword"> const </span>{
<a name="l00560"></a>00560         <span class="keywordflow">return</span> lifetime.add(std::move(s));
<a name="l00561"></a>00561     }
<a name="l00562"></a>00562     <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00563"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#adee88ee46a940594586507717b807704">00563</a>     <span class="keyword">auto</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab5e1c566f5974a74abb5fefb05c043a7">add</a>(F f) <span class="keyword">const</span>
<a name="l00564"></a>00564     -&gt; <span class="keyword">typename</span> std::enable_if&lt;rxcpp::detail::is_unsubscribe_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">weak_subscription</a>&gt;::type {
<a name="l00565"></a>00565         <span class="keywordflow">return</span> lifetime.add(<a class="code" href="namespacerxcpp.html#ad5748f0387efa7bbc2b8d19b0842c40b">make_subscription</a>(std::move(f)));
<a name="l00566"></a>00566     }
<a name="l00567"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a428807ac9037d03a754bfac19d97f60e">00567</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <span class="keyword">remove</span>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a615acb6eadc417ccda01305d828cb55d">weak_subscription</a> w) <span class="keyword">const</span> {
<a name="l00568"></a>00568         <span class="keywordflow">return</span> lifetime.remove(std::move(w));
<a name="l00569"></a>00569     }
<a name="l00570"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae35fcc6268c2f5c5f24f82ff49baa726">00570</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae35fcc6268c2f5c5f24f82ff49baa726">clear</a>()<span class="keyword"> const </span>{
<a name="l00571"></a>00571         <span class="keywordflow">return</span> lifetime.clear();
<a name="l00572"></a>00572     }
<a name="l00573"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae64960bb0c85ced4b1c5ba966b140931">00573</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ae64960bb0c85ced4b1c5ba966b140931">unsubscribe</a>()<span class="keyword"> const </span>{
<a name="l00574"></a>00574         <span class="keywordflow">return</span> lifetime.unsubscribe();
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     <span class="comment">// scheduler</span>
<a name="l00578"></a>00578     <span class="comment">//</span>
<a name="l00579"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a7ee2fa1cd62d17a45c8e38d3d28916e1">00579</a>     <span class="keyword">inline</span> clock_type::time_point <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a7ee2fa1cd62d17a45c8e38d3d28916e1">now</a>()<span class="keyword"> const </span>{
<a name="l00580"></a>00580         <span class="keywordflow">return</span> controller.now();
<a name="l00581"></a>00581     }
<a name="l00583"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ad62a908090afb539bd51ba02f31406a8">00583</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ad62a908090afb539bd51ba02f31406a8" title="put this on the queue of the stored scheduler to run asap">schedule</a>()<span class="keyword"> const </span>{
<a name="l00584"></a>00584         <span class="keywordflow">if</span> (<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">is_subscribed</a>()) {
<a name="l00585"></a>00585             controller.schedule(*<span class="keyword">this</span>);
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587     }
<a name="l00589"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a2f2e957fac85139b7d9dd69688119958">00589</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a2f2e957fac85139b7d9dd69688119958" title="put this on the queue of the stored scheduler to run at the specified time">schedule</a>(clock_type::time_point when)<span class="keyword"> const </span>{
<a name="l00590"></a>00590         <span class="keywordflow">if</span> (<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">is_subscribed</a>()) {
<a name="l00591"></a>00591             controller.schedule(when, *<span class="keyword">this</span>);
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593     }
<a name="l00595"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3a1037d1a7cf232890d9b772ef92703c">00595</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a3a1037d1a7cf232890d9b772ef92703c" title="put this on the queue of the stored scheduler to run after a delay from now">schedule</a>(clock_type::duration when)<span class="keyword"> const </span>{
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">is_subscribed</a>()) {
<a name="l00597"></a>00597             controller.schedule(when, *<span class="keyword">this</span>);
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="comment">// action</span>
<a name="l00602"></a>00602     <span class="comment">//</span>
<a name="l00604"></a><a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a23a78642a0e5359c577b71ea2cec2d48">00604</a> <span class="comment"></span>    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a23a78642a0e5359c577b71ea2cec2d48" title="invokes the action">operator()</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r)<span class="keyword"> const </span>{
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (!<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a8f8940e87b1af3d19db547b52ef6253e">is_subscribed</a>()) {
<a name="l00606"></a>00606             <span class="keywordflow">return</span>;
<a name="l00607"></a>00607         }
<a name="l00608"></a>00608         detacher protect(<span class="keyword">this</span>);
<a name="l00609"></a>00609         activity(*<span class="keyword">this</span>, r);
<a name="l00610"></a>00610         protect.that = <span class="keyword">nullptr</span>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 };
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="keyword">struct </span>current_thread;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keyword">namespace </span>detail {
<a name="l00617"></a>00617 
<a name="l00618"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">00618</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">action_type</a>
<a name="l00619"></a>00619     : <span class="keyword">public</span> std::<a class="code" href="classstd_1_1enable__shared__from__this.html">enable_shared_from_this</a>&lt;action_type&gt;
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621     <span class="keyword">typedef</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">action_type</a> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">this_type</a>;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="keyword">public</span>:
<a name="l00624"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#af7859e9893c9a0cb9575a540d49f1921">00624</a>     <span class="keyword">typedef</span> std::function&lt;void(const schedulable&amp;, const recurse&amp;)&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#af7859e9893c9a0cb9575a540d49f1921">function_type</a>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="keyword">private</span>:
<a name="l00627"></a>00627     <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#af7859e9893c9a0cb9575a540d49f1921">function_type</a> f;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="keyword">public</span>:
<a name="l00630"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#a7b960ce1b075729e2093b31ac301e2c5">00630</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">action_type</a>()
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#a8b532b3adf0954b555d7d02eff98cd7c">00634</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html">action_type</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#af7859e9893c9a0cb9575a540d49f1921">function_type</a> f)
<a name="l00635"></a>00635         : f(std::move(f))
<a name="l00636"></a>00636     {
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638 
<a name="l00639"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#aaecbe7ee73265f8d86e2f6cde8d17c94">00639</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1action__type.html#aaecbe7ee73265f8d86e2f6cde8d17c94">operator()</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; s, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r) {
<a name="l00640"></a>00640         <span class="keywordflow">if</span> (!f) {
<a name="l00641"></a>00641             abort();
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643         f(s, r);
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 };
<a name="l00646"></a>00646 
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 
<a name="l00649"></a><a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ae7fda8d51056eb1916fc9bb366a62f61">00649</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ae7fda8d51056eb1916fc9bb366a62f61" title="call the function">action::operator()</a>(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; s, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r)<span class="keyword"> const </span>{
<a name="l00650"></a>00650     (*inner)(s, r);
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#ae284675801cc7ee9d45606f4034eb395">00653</a> <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> <a class="code" href="namespacerxcpp_1_1schedulers.html#ae284675801cc7ee9d45606f4034eb395">make_action_empty</a>() {
<a name="l00654"></a>00654     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html#ab5de5c2c2c2072d8ab8569bb51de6771" title="return the empty action">action::empty</a>();
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00658"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">00658</a> <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(F&amp;&amp; f) {
<a name="l00659"></a>00659     static_assert(<a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1is__action__function.html">detail::is_action_function&lt;F&gt;::value</a>, <span class="stringliteral">&quot;action function must be void(schedulable)&quot;</span>);
<a name="l00660"></a>00660     <span class="keyword">auto</span> fn = std::forward&lt;F&gt;(f);
<a name="l00661"></a>00661     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a>(std::make_shared&lt;detail::action_type&gt;(
<a name="l00662"></a>00662         <span class="comment">// tail-recurse inside of the virtual function call</span>
<a name="l00663"></a>00663         <span class="comment">// until a new action, lifetime or scheduler is returned</span>
<a name="l00664"></a>00664         [fn](<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; s, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html">recurse</a>&amp; r) {
<a name="l00665"></a>00665             <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().action_enter(s);
<a name="l00666"></a>00666             <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1sources.html#ae41049dd8bd03e1a482d7a0c492c832f">scope</a> = s.<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#af90a8fc1c5c9ec22cb5db31aa3ea38d4">set_recursed</a>(r);
<a name="l00667"></a>00667             <span class="keywordflow">while</span> (s.<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#a5f205d35d687432625d8a44994a59c53">is_subscribed</a>()) {
<a name="l00668"></a>00668                 r.<a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ae698cfb8388cd3db6df9ddae343ece42" title="reset the function request. call before each call to the function.">reset</a>();
<a name="l00669"></a>00669                 fn(s);
<a name="l00670"></a>00670                 <span class="keywordflow">if</span> (!r.<a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#a8727f7e68d568cebefabd41eaf8b29d2" title="does the scheduler allow tail-recursion now?">is_allowed</a>() || !r.<a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ad258c69e557c230d26619344f49cca38" title="did the function request to be recursed?">is_requested</a>()) {
<a name="l00671"></a>00671                     <span class="keywordflow">if</span> (r.<a class="code" href="classrxcpp_1_1schedulers_1_1recurse.html#ad258c69e557c230d26619344f49cca38" title="did the function request to be recursed?">is_requested</a>()) {
<a name="l00672"></a>00672                         s.<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html#ad62a908090afb539bd51ba02f31406a8" title="put this on the queue of the stored scheduler to run asap">schedule</a>();
<a name="l00673"></a>00673                     }
<a name="l00674"></a>00674                     <span class="keywordflow">break</span>;
<a name="l00675"></a>00675                 }
<a name="l00676"></a>00676                 <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().action_recurse(s);
<a name="l00677"></a>00677             }
<a name="l00678"></a>00678             <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().action_return(s);
<a name="l00679"></a>00679         }));
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">// copy</span>
<a name="l00683"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">00683</a> <span class="keyword">inline</span> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(
<a name="l00684"></a>00684     <span class="keyword">const</span>   <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp; scbl)
<a name="l00685"></a>00685     -&gt;      <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> {
<a name="l00686"></a>00686     <span class="keywordflow">return</span>  <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(scbl);
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 <span class="comment">// move</span>
<a name="l00689"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a7f4c451d3952ccd33a9f3ca91a859e65">00689</a> <span class="keyword">inline</span> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(
<a name="l00690"></a>00690             <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&amp;&amp; scbl)
<a name="l00691"></a>00691     -&gt;      <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> {
<a name="l00692"></a>00692     <span class="keywordflow">return</span>  <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(std::move(scbl));
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a0dca2fb32c9fbd6a3582f2ed9a062c7b">00695</a> <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> a) {
<a name="l00696"></a>00696     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(sc, a);
<a name="l00697"></a>00697 }
<a name="l00698"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a41073f8741948c2c023a9a6d16ca71f0">00698</a> <span class="keyword">inline</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, <a class="code" href="classrxcpp_1_1schedulers_1_1action.html" title="action provides type-forgetting for a potentially recursive set of calls to a function that takes a s...">action</a> a) {
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(cs, sc, a);
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00703"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#af5854301990e1570e07009ce5b9e53ff">00703</a> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, F&amp;&amp; f)
<a name="l00704"></a>00704     -&gt; <span class="keyword">typename</span> std::enable_if&lt;detail::is_action_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&gt;::type {
<a name="l00705"></a>00705     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(sc, <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(std::forward&lt;F&gt;(f)));
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00708"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a42d48ab48cf0661e47e5988ee323755b">00708</a> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, F&amp;&amp; f)
<a name="l00709"></a>00709     -&gt; <span class="keyword">typename</span> std::enable_if&lt;detail::is_action_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&gt;::type {
<a name="l00710"></a>00710     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(cs, sc, <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(std::forward&lt;F&gt;(f)));
<a name="l00711"></a>00711 }
<a name="l00712"></a>00712 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00713"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a1fce45feec806bff9a8fc29d82e3b4f0">00713</a> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs, F&amp;&amp; f)
<a name="l00714"></a>00714     -&gt; <span class="keyword">typename</span> std::enable_if&lt;detail::is_action_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&gt;::type {
<a name="l00715"></a>00715     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(cs, scbl.get_worker(), <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(std::forward&lt;F&gt;(f)));
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00718"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a395ad07c593aef3081dca84d5747174e">00718</a> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, F&amp;&amp; f)
<a name="l00719"></a>00719     -&gt; <span class="keyword">typename</span> std::enable_if&lt;detail::is_action_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&gt;::type {
<a name="l00720"></a>00720     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(scbl, sc, <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(std::forward&lt;F&gt;(f)));
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00723"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a8616d18908f9e993ca4ec26a4afcfcf8">00723</a> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, F&amp;&amp; f)
<a name="l00724"></a>00724     -&gt; <span class="keyword">typename</span> std::enable_if&lt;detail::is_action_function&lt;F&gt;::value, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>&gt;::type {
<a name="l00725"></a>00725     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(scbl, scbl.get_worker(), <a class="code" href="namespacerxcpp_1_1schedulers.html#a18303937802b8fdea0fe14b7d13c7c6c">make_action</a>(std::forward&lt;F&gt;(f)));
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727 
<a name="l00728"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a9d80ad009dceff8a8b2e34e3be3c3b5e">00728</a> <span class="keyword">inline</span> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs)
<a name="l00729"></a>00729     -&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> {
<a name="l00730"></a>00730     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(cs, scbl.get_worker(), scbl.get_action());
<a name="l00731"></a>00731 }
<a name="l00732"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a12a03b70d3314d95011d1104364eeb4f">00732</a> <span class="keyword">inline</span> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc, <a class="code" href="classrxcpp_1_1composite__subscription.html" title="controls lifetime for scheduler::schedule and observable&lt;T, SourceOperator&gt;::subscribe.">composite_subscription</a> cs)
<a name="l00733"></a>00733     -&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> {
<a name="l00734"></a>00734     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(cs, sc, scbl.get_action());
<a name="l00735"></a>00735 }
<a name="l00736"></a><a class="code" href="namespacerxcpp_1_1schedulers.html#a12cc94d162b6e93032809fb516babfd1">00736</a> <span class="keyword">inline</span> <span class="keyword">auto</span> <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(<a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> scbl, <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html">worker</a> sc)
<a name="l00737"></a>00737     -&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> {
<a name="l00738"></a>00738     <span class="keywordflow">return</span> <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a>(scbl, sc, scbl.get_action());
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 <span class="keyword">template</span>&lt;<span class="keyword">class </span>Arg0, <span class="keyword">class</span>... ArgN&gt;
<a name="l00742"></a>00742 <span class="keyword">auto</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd" title="insert the supplied schedulable to be run as soon as possible">worker::schedule</a>(Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00743"></a>00743     -&gt; typename std::enable_if&lt;
<a name="l00744"></a>00744         (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00745"></a>00745         <a class="code" href="classrxcpp_1_1is__subscription.html">is_subscription</a>&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00746"></a>00746         !<a class="code" href="classrxcpp_1_1is__schedulable.html">is_schedulable</a>&lt;Arg0&gt;::value&gt;::type {
<a name="l00747"></a>00747     <span class="keyword">auto</span> scbl = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(*<span class="keyword">this</span>, std::forward&lt;Arg0&gt;(a0), std::forward&lt;ArgN&gt;(an)...);
<a name="l00748"></a>00748     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_enter(*inner.get(), scbl);
<a name="l00749"></a>00749     inner-&gt;schedule(std::move(scbl));
<a name="l00750"></a>00750     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_return(*inner.get());
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 <span class="keyword">template</span>&lt;<span class="keyword">class</span>... ArgN&gt;
<a name="l00753"></a>00753 <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">worker::schedule_rebind</a>(<span class="keyword">const</span> schedulable&amp; scbl, ArgN&amp;&amp;... an)<span class="keyword"> const </span>{
<a name="l00754"></a>00754     <span class="keyword">auto</span> rescbl = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(scbl, *<span class="keyword">this</span>, std::forward&lt;ArgN&gt;(an)...);
<a name="l00755"></a>00755     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_enter(*inner.get(), rescbl);
<a name="l00756"></a>00756     inner-&gt;schedule(std::move(rescbl));
<a name="l00757"></a>00757     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_return(*inner.get());
<a name="l00758"></a>00758 }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 <span class="keyword">template</span>&lt;<span class="keyword">class </span>Arg0, <span class="keyword">class</span>... ArgN&gt;
<a name="l00761"></a>00761 <span class="keyword">auto</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a1fec2f196a0f9729a251ab21c1da03cd" title="insert the supplied schedulable to be run as soon as possible">worker::schedule</a>(clock_type::time_point when, Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00762"></a>00762     -&gt; typename std::enable_if&lt;
<a name="l00763"></a>00763         (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00764"></a>00764         is_subscription&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00765"></a>00765         !is_schedulable&lt;Arg0&gt;::value&gt;::type {
<a name="l00766"></a>00766     <span class="keyword">auto</span> scbl = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(*<span class="keyword">this</span>, std::forward&lt;Arg0&gt;(a0), std::forward&lt;ArgN&gt;(an)...);
<a name="l00767"></a>00767     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_enter(*inner.get(), when, scbl);
<a name="l00768"></a>00768     inner-&gt;schedule(when, std::move(scbl));
<a name="l00769"></a>00769     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_return(*inner.get());
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 <span class="keyword">template</span>&lt;<span class="keyword">class</span>... ArgN&gt;
<a name="l00772"></a>00772 <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a77de2cfb8f51f30bbc2e5d78ecafd60d">worker::schedule_rebind</a>(clock_type::time_point when, <span class="keyword">const</span> schedulable&amp; scbl, ArgN&amp;&amp;... an)<span class="keyword"> const </span>{
<a name="l00773"></a>00773     <span class="keyword">auto</span> rescbl = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(scbl, *<span class="keyword">this</span>, std::forward&lt;ArgN&gt;(an)...);
<a name="l00774"></a>00774     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_enter(*inner.get(), when, rescbl);
<a name="l00775"></a>00775     inner-&gt;schedule(when, std::move(rescbl));
<a name="l00776"></a>00776     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_return(*inner.get());
<a name="l00777"></a>00777 }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="keyword">template</span>&lt;<span class="keyword">class </span>Arg0, <span class="keyword">class</span>... ArgN&gt;
<a name="l00780"></a>00780 <span class="keyword">auto</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#ab62a74b37fd25d73239204e93d1cece9">worker::schedule_periodically</a>(clock_type::time_point initial, clock_type::duration period, Arg0&amp;&amp; a0, ArgN&amp;&amp;... an) const
<a name="l00781"></a>00781     -&gt; typename std::enable_if&lt;
<a name="l00782"></a>00782         (detail::is_action_function&lt;Arg0&gt;::value ||
<a name="l00783"></a>00783         is_subscription&lt;Arg0&gt;::value) &amp;&amp;
<a name="l00784"></a>00784         !is_schedulable&lt;Arg0&gt;::value&gt;::type {
<a name="l00785"></a>00785     <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">schedule_periodically_rebind</a>(initial, period, <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(*<span class="keyword">this</span>, std::forward&lt;Arg0&gt;(a0), std::forward&lt;ArgN&gt;(an)...));
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 <span class="keyword">template</span>&lt;<span class="keyword">class</span>... ArgN&gt;
<a name="l00788"></a>00788 <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1worker.html#a7d43bfdb77ef606c015cd3808356b7ce">worker::schedule_periodically_rebind</a>(clock_type::time_point initial, clock_type::duration period, <span class="keyword">const</span> schedulable&amp; scbl, ArgN&amp;&amp;... an)<span class="keyword"> const </span>{
<a name="l00789"></a>00789     <span class="keyword">auto</span> target = std::make_shared&lt;clock_type::time_point&gt;(initial);
<a name="l00790"></a>00790     <span class="keyword">auto</span> activity = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(scbl, *<span class="keyword">this</span>, std::forward&lt;ArgN&gt;(an)...);
<a name="l00791"></a>00791     <span class="keyword">auto</span> periodic = <a class="code" href="namespacerxcpp_1_1schedulers.html#a499aab04c78b2b65fdae53b594561110">make_schedulable</a>(
<a name="l00792"></a>00792         activity,
<a name="l00793"></a>00793         [target, period, activity](schedulable <span class="keyword">self</span>) {
<a name="l00794"></a>00794             <span class="comment">// any recursion requests will be pushed to the scheduler queue</span>
<a name="l00795"></a>00795             recursion r(<span class="keyword">false</span>);
<a name="l00796"></a>00796             <span class="comment">// call action</span>
<a name="l00797"></a>00797             activity(r.get_recurse());
<a name="l00798"></a>00798 
<a name="l00799"></a>00799             <span class="comment">// schedule next occurance (if the action took longer than &#39;period&#39; target will be in the past)</span>
<a name="l00800"></a>00800             *target += period;
<a name="l00801"></a>00801             <span class="keyword">self</span>.schedule(*target);
<a name="l00802"></a>00802         });
<a name="l00803"></a>00803     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_enter(*inner.get(), *target, periodic);
<a name="l00804"></a>00804     inner-&gt;schedule(*target, periodic);
<a name="l00805"></a>00805     <a class="code" href="namespacerxcpp.html#a14cd85c5fef69466f6e0e72fbe26f09f">trace_activity</a>().schedule_when_return(*inner.get());
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="keyword">namespace </span>detail {
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 <span class="keyword">template</span>&lt;<span class="keyword">class</span> TimePo<span class="keywordtype">int</span>&gt;
<a name="l00811"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">00811</a> <span class="keyword">struct </span><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">time_schedulable</a>
<a name="l00812"></a>00812 {
<a name="l00813"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#a12f3c62a7a8198f5dd1a0ea5fbe5cddf">00813</a>     <span class="keyword">typedef</span> TimePoint <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#a12f3c62a7a8198f5dd1a0ea5fbe5cddf">time_point_type</a>;
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#abafd0dff7e3df32a0e08cd3d2c4edd08">00815</a>     <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">time_schedulable</a>(TimePoint when, <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> a)
<a name="l00816"></a>00816         : when(when)
<a name="l00817"></a>00817         , what(std::move(a))
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819     }
<a name="l00820"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#a12da3782749706b79c46660c6b71ac33">00820</a>     TimePoint <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#a12da3782749706b79c46660c6b71ac33">when</a>;
<a name="l00821"></a><a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#ae8de78fbee1bf4f67e3fcf633e841c2c">00821</a>     <a class="code" href="classrxcpp_1_1schedulers_1_1schedulable.html">schedulable</a> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#ae8de78fbee1bf4f67e3fcf633e841c2c">what</a>;
<a name="l00822"></a>00822 };
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 
<a name="l00825"></a>00825 <span class="comment">// Sorts time_schedulable items in priority order sorted</span>
<a name="l00826"></a>00826 <span class="comment">// on value of time_schedulable.when. Items with equal</span>
<a name="l00827"></a>00827 <span class="comment">// values for when are sorted in fifo order.</span>
<a name="l00828"></a>00828 <span class="keyword">template</span>&lt;<span class="keyword">class</span> TimePo<span class="keywordtype">int</span>&gt;
<a name="l00829"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html">00829</a> <span class="keyword">class </span><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html">schedulable_queue</a> {
<a name="l00830"></a>00830 <span class="keyword">public</span>:
<a name="l00831"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a9c06321622544a63a22ff69712765738">00831</a>     <span class="keyword">typedef</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">time_schedulable&lt;TimePoint&gt;</a> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a9c06321622544a63a22ff69712765738">item_type</a>;
<a name="l00832"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">00832</a>     <span class="keyword">typedef</span> std::pair&lt;item_type, int64_t&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">elem_type</a>;
<a name="l00833"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a75748260d0a471b438be841369cc202c">00833</a>     <span class="keyword">typedef</span> std::vector&lt;elem_type&gt; <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a75748260d0a471b438be841369cc202c">container_type</a>;
<a name="l00834"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#ada990263d5f299aaced309f43004682e">00834</a>     <span class="keyword">typedef</span> <span class="keyword">const</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">item_type</a>&amp; <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#ada990263d5f299aaced309f43004682e">const_reference</a>;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 <span class="keyword">private</span>:
<a name="l00837"></a>00837     <span class="keyword">struct </span>compare_elem
<a name="l00838"></a>00838     {
<a name="l00839"></a>00839         <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">elem_type</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">elem_type</a>&amp; rhs)<span class="keyword"> const </span>{
<a name="l00840"></a>00840             <span class="keywordflow">if</span> (lhs.first.when == rhs.first.when) {
<a name="l00841"></a>00841                 <span class="keywordflow">return</span> lhs.second &gt; rhs.second;
<a name="l00842"></a>00842             }
<a name="l00843"></a>00843             <span class="keywordflow">else</span> {
<a name="l00844"></a>00844                 <span class="keywordflow">return</span> lhs.first.<a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html#a12da3782749706b79c46660c6b71ac33">when</a> &gt; rhs.first.when;
<a name="l00845"></a>00845             }
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847     };
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     <span class="keyword">typedef</span> std::priority_queue&lt;
<a name="l00850"></a>00850         elem_type,
<a name="l00851"></a>00851         container_type,
<a name="l00852"></a>00852         compare_elem
<a name="l00853"></a>00853     &gt; queue_type;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855     queue_type queue;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857     int64_t ordinal;
<a name="l00858"></a>00858 <span class="keyword">public</span>:
<a name="l00859"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a7b4253c5ec3ed178ef8fa5cc47e79930">00859</a>     <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">const_reference</a> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a7b4253c5ec3ed178ef8fa5cc47e79930">top</a>()<span class="keyword"> const </span>{
<a name="l00860"></a>00860         <span class="keywordflow">return</span> queue.top().first;
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862 
<a name="l00863"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a364b499ffb08fda2c9ba4c4dde8ea487">00863</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a364b499ffb08fda2c9ba4c4dde8ea487">pop</a>() {
<a name="l00864"></a>00864         queue.pop();
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#ad84a578d6524f1604a116ffea5b8b4be">00867</a>     <span class="keywordtype">bool</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#ad84a578d6524f1604a116ffea5b8b4be">empty</a>()<span class="keyword"> const </span>{
<a name="l00868"></a>00868         <span class="keywordflow">return</span> queue.empty();
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870 
<a name="l00871"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#afc58432852578b6558603bab52c2a08b">00871</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#afc58432852578b6558603bab52c2a08b">push</a>(<span class="keyword">const</span> <a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">item_type</a>&amp; value) {
<a name="l00872"></a>00872         queue.push(<a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">elem_type</a>(value, ordinal++));
<a name="l00873"></a>00873     }
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#af2cd2a2662b64bc941142f01eb8e37dc">00875</a>     <span class="keywordtype">void</span> <a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#af2cd2a2662b64bc941142f01eb8e37dc">push</a>(<a class="code" href="structrxcpp_1_1schedulers_1_1detail_1_1time__schedulable.html">item_type</a>&amp;&amp; value) {
<a name="l00876"></a>00876         queue.push(<a class="code" href="classrxcpp_1_1schedulers_1_1detail_1_1schedulable__queue.html#a389ce2688e71609625e5bc91c50bfb47">elem_type</a>(std::move(value), ordinal++));
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878 };
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 <span class="keyword">namespace </span>rxsc=schedulers;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="preprocessor">#include &quot;<a class="code" href="rx-currentthread_8hpp.html">schedulers/rx-currentthread.hpp</a>&quot;</span>
<a name="l00888"></a>00888 <span class="preprocessor">#include &quot;<a class="code" href="rx-newthread_8hpp.html">schedulers/rx-newthread.hpp</a>&quot;</span>
<a name="l00889"></a>00889 <span class="preprocessor">#include &quot;<a class="code" href="rx-eventloop_8hpp.html">schedulers/rx-eventloop.hpp</a>&quot;</span>
<a name="l00890"></a>00890 <span class="preprocessor">#include &quot;<a class="code" href="rx-immediate_8hpp.html">schedulers/rx-immediate.hpp</a>&quot;</span>
<a name="l00891"></a>00891 <span class="preprocessor">#include &quot;<a class="code" href="rx-virtualtime_8hpp.html">schedulers/rx-virtualtime.hpp</a>&quot;</span>
<a name="l00892"></a>00892 <span class="preprocessor">#include &quot;<a class="code" href="rx-sameworker_8hpp.html">schedulers/rx-sameworker.hpp</a>&quot;</span>
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun May 17 2015 13:59:33 for RxCpp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
